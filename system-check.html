<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ ì‹œìŠ¤í…œ ì§„ë‹¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">ğŸ”§ APEC ì‹œìŠ¤í…œ ì§„ë‹¨</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“Š ë°°í¬ ìƒíƒœ í™•ì¸</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <button onclick="checkFunctionEndpoint()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    ğŸ”— Functions ì—”ë“œí¬ì¸íŠ¸ ì²´í¬
                </button>
                <button onclick="checkAlternativePaths()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    ğŸ“ ë‹¤ë¥¸ ê²½ë¡œë“¤ í…ŒìŠ¤íŠ¸
                </button>
                <button onclick="checkDeployInfo()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    ğŸš€ ë°°í¬ ì •ë³´ í™•ì¸
                </button>
                <button onclick="clearLogs()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                    ğŸ§¹ ë¡œê·¸ ì§€ìš°ê¸°
                </button>
            </div>
            
            <div class="mb-4">
                <h3 class="text-lg font-semibold mb-2">âš¡ ë¹ ë¥¸ í…ŒìŠ¤íŠ¸</h3>
                <button onclick="runFullDiagnostic()" class="bg-red-500 text-white px-6 py-3 rounded hover:bg-red-600 text-lg">
                    ğŸ¯ ì „ì²´ ì§„ë‹¨ ì‹¤í–‰
                </button>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“‹ ì§„ë‹¨ ë¡œê·¸</h2>
            <div id="logContainer" class="bg-gray-900 text-green-400 p-4 rounded font-mono text-sm h-96 overflow-y-auto">
                <div class="text-yellow-400">ğŸš€ APEC ì‹œìŠ¤í…œ ì§„ë‹¨ ì¤€ë¹„ ì™„ë£Œ...</div>
            </div>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const container = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'error': 'text-red-400',
                'success': 'text-green-400',
                'warning': 'text-yellow-400',
                'info': 'text-blue-400'
            };
            
            container.innerHTML += `<div class="${colors[type] || 'text-green-400'}">[${timestamp}] ${message}</div>`;
            container.scrollTop = container.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '<div class="text-yellow-400">ğŸ§¹ ë¡œê·¸ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤.</div>';
        }

        async function checkFunctionEndpoint() {
            log('ğŸ”— Functions ì—”ë“œí¬ì¸íŠ¸ ìƒì„¸ ì²´í¬ ì‹œì‘...', 'info');
            
            const paths = [
                '/.netlify/functions/airtable-proxy',
                '/netlify/functions/airtable-proxy', 
                '/.netlify/functions/airtable-proxy/',
                '/functions/airtable-proxy'
            ];
            
            for (const path of paths) {
                try {
                    log(`ğŸ“¡ í…ŒìŠ¤íŠ¸ ê²½ë¡œ: ${path}`, 'info');
                    
                    const response = await fetch(path, {
                        method: 'OPTIONS'
                    });
                    
                    log(`   ì‘ë‹µ: ${response.status} ${response.statusText}`, 
                        response.status === 200 ? 'success' : 'warning');
                        
                } catch (error) {
                    log(`   ì—ëŸ¬: ${error.message}`, 'error');
                }
            }
        }

        async function checkAlternativePaths() {
            log('ğŸ“ ëŒ€ì²´ ê²½ë¡œ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            const testPaths = [
                '/api/airtable',
                '/functions/proxy',
                '/.netlify/functions/',
                '/netlify/functions/',
                '/_functions/airtable-proxy'
            ];
            
            for (const path of testPaths) {
                try {
                    const response = await fetch(path);
                    log(`ğŸ“‚ ${path} â†’ ${response.status}`, 
                        response.status < 500 ? 'success' : 'warning');
                } catch (error) {
                    log(`ğŸ“‚ ${path} â†’ ì ‘ê·¼ ë¶ˆê°€`, 'error');
                }
            }
        }

        async function checkDeployInfo() {
            log('ğŸš€ ë°°í¬ í™˜ê²½ ì •ë³´ ìˆ˜ì§‘...', 'info');
            
            // í˜„ì¬ URL ì •ë³´
            log(`ğŸŒ í˜„ì¬ ë„ë©”ì¸: ${window.location.hostname}`, 'info');
            log(`ğŸ“ í˜„ì¬ ê²½ë¡œ: ${window.location.pathname}`, 'info');
            log(`ğŸ”— í˜„ì¬ ì „ì²´ URL: ${window.location.href}`, 'info');
            
            // ë¸Œë¼ìš°ì € ì •ë³´
            log(`ğŸ’» User Agent: ${navigator.userAgent}`, 'info');
            
            // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸
            try {
                const response = await fetch('/');
                log(`ğŸ  ë©”ì¸ í˜ì´ì§€ ì‘ë‹µ: ${response.status}`, 'success');
                
                // ì‘ë‹µ í—¤ë” í™•ì¸
                const server = response.headers.get('server');
                if (server) {
                    log(`ğŸ–¥ï¸ ì„œë²„ ì •ë³´: ${server}`, 'info');
                }
                
            } catch (error) {
                log(`âŒ ë©”ì¸ í˜ì´ì§€ ì ‘ê·¼ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        async function runFullDiagnostic() {
            log('ğŸ¯ ì „ì²´ ì§„ë‹¨ ì‹œì‘...', 'warning');
            log('=' .repeat(50), 'info');
            
            await checkDeployInfo();
            log('-'.repeat(30), 'info');
            
            await checkFunctionEndpoint();
            log('-'.repeat(30), 'info');
            
            await checkAlternativePaths();
            log('-'.repeat(30), 'info');
            
            log('âœ… ì „ì²´ ì§„ë‹¨ ì™„ë£Œ!', 'success');
            log('ğŸ’¡ ìœ„ ê²°ê³¼ë¥¼ ê°œë°œíŒ€ì— ê³µìœ í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í•˜ì„¸ìš”.', 'warning');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ ì •ë³´ í‘œì‹œ
        window.addEventListener('load', () => {
            log('ğŸ“ ì‹œìŠ¤í…œ ì§„ë‹¨ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ', 'success');
            log('ğŸ”§ ì§„ë‹¨ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‹œìŠ¤í…œ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.', 'info');
        });
    </script>
</body>
</html>