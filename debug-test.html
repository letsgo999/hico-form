<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ APEC ì‹œìŠ¤í…œ ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .log-success { color: #10B981; }
        .log-error { color: #EF4444; }
        .log-info { color: #3B82F6; }
        .log-warning { color: #F59E0B; }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">ğŸ”§ APEC ì‹œìŠ¤í…œ ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <button onclick="testProxyEndpoint()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    ğŸ”— í”„ë¡ì‹œ ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
                </button>
                <button onclick="testAirtableConnection()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    ğŸ“¡ ì—ì–´í…Œì´ë¸” ì—°ê²° í…ŒìŠ¤íŠ¸
                </button>
                <button onclick="testCreateRecord()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    ğŸ“ ë ˆì½”ë“œ ìƒì„± í…ŒìŠ¤íŠ¸
                </button>
                <button onclick="clearLogs()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                    ğŸ§¹ ë¡œê·¸ ì§€ìš°ê¸°
                </button>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“‹ í…ŒìŠ¤íŠ¸ ë¡œê·¸</h2>
            <div id="logContainer" class="bg-gray-900 text-green-400 p-4 rounded font-mono text-sm h-96 overflow-y-auto">
                <div>ğŸš€ APEC ì‹œìŠ¤í…œ ë””ë²„ê·¸ ì‹œì‘...</div>
            </div>
        </div>
    </div>

    <script>
        const PROXY_ENDPOINT = '/.netlify/functions/airtable-proxy';
        
        function log(message, type = 'info') {
            const container = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const logClass = type === 'error' ? 'log-error' : 
                           type === 'success' ? 'log-success' : 
                           type === 'warning' ? 'log-warning' : 'log-info';
            
            container.innerHTML += `<div class="${logClass}">[${timestamp}] ${message}</div>`;
            container.scrollTop = container.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '<div>ğŸ§¹ ë¡œê·¸ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤.</div>';
        }

        async function testProxyEndpoint() {
            log('ğŸ”— í”„ë¡ì‹œ ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            try {
                // OPTIONS ìš”ì²­ í…ŒìŠ¤íŠ¸ (CORS preflight)
                const optionsResponse = await fetch(PROXY_ENDPOINT, {
                    method: 'OPTIONS'
                });
                
                log(`âœ… CORS preflight: ${optionsResponse.status}`, 'success');
                
                // í”„ë¡ì‹œ í•¨ìˆ˜ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
                if (optionsResponse.status === 200) {
                    log('âœ… í”„ë¡ì‹œ í•¨ìˆ˜ê°€ ì •ìƒì ìœ¼ë¡œ ë°°í¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } else {
                    log('âŒ í”„ë¡ì‹œ í•¨ìˆ˜ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.', 'error');
                }
                
            } catch (error) {
                log(`âŒ í”„ë¡ì‹œ ì—”ë“œí¬ì¸íŠ¸ ì—ëŸ¬: ${error.message}`, 'error');
            }
        }

        async function testAirtableConnection() {
            log('ğŸ“¡ ì—ì–´í…Œì´ë¸” ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            try {
                const response = await fetch(PROXY_ENDPOINT, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                log(`ğŸ“¡ ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.statusText}`, 'info');

                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… ì—ì–´í…Œì´ë¸” ì—°ê²° ì„±ê³µ! ê¸°ì¡´ ë ˆì½”ë“œ ìˆ˜: ${data.length}ê°œ`, 'success');
                    log(`ğŸ“Š ì²« ë²ˆì§¸ ë ˆì½”ë“œ ì˜ˆì‹œ: ${JSON.stringify(data[0] || {}, null, 2)}`, 'info');
                } else {
                    const errorData = await response.json();
                    log(`âŒ ì—ì–´í…Œì´ë¸” ì—°ê²° ì‹¤íŒ¨: ${JSON.stringify(errorData, null, 2)}`, 'error');
                    
                    if (response.status === 500) {
                        log('ğŸ’¡ í™˜ê²½ë³€ìˆ˜ ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš” (AIRTABLE_API_KEY, AIRTABLE_BASE_ID)', 'warning');
                    }
                }
                
            } catch (error) {
                log(`âŒ ì—°ê²° í…ŒìŠ¤íŠ¸ ì—ëŸ¬: ${error.message}`, 'error');
            }
        }

        async function testCreateRecord() {
            log('ğŸ“ ë ˆì½”ë“œ ìƒì„± í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            const testData = {
                'Name': `í…ŒìŠ¤íŠ¸ì‚¬ìš©ì_${Date.now()}`,
                'Phone': '010-1234-5678',
                'Email': 'debug@test.com',
                'Performance Type': 'Traditional',
                'Status': 'Pending',
                'Submitted At': new Date().toISOString()
            };

            log(`ğŸ“¤ ì „ì†¡í•  ë°ì´í„°: ${JSON.stringify(testData, null, 2)}`, 'info');
            
            try {
                const response = await fetch(PROXY_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });

                log(`ğŸ“¡ ìƒì„± ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.statusText}`, 'info');

                if (response.ok) {
                    const result = await response.json();
                    log(`âœ… ë ˆì½”ë“œ ìƒì„± ì„±ê³µ! ID: ${result.id}`, 'success');
                    log(`ğŸ“‹ ìƒì„±ëœ ë ˆì½”ë“œ: ${JSON.stringify(result, null, 2)}`, 'success');
                } else {
                    const errorData = await response.json();
                    log(`âŒ ë ˆì½”ë“œ ìƒì„± ì‹¤íŒ¨: ${JSON.stringify(errorData, null, 2)}`, 'error');
                }
                
            } catch (error) {
                log(`âŒ ìƒì„± í…ŒìŠ¤íŠ¸ ì—ëŸ¬: ${error.message}`, 'error');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.addEventListener('load', () => {
            log('ğŸ¯ ìë™ ì§„ë‹¨ì„ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');
            setTimeout(testProxyEndpoint, 1000);
        });
    </script>
</body>
</html>